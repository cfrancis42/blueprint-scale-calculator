<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blueprint Scale Calculator</title>
<meta name="theme-color" content="#0b6bff">
<style>
  :root { --pad: 14px; --radius: 12px; }
  * { box-sizing: border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  body { margin: 0; background: #f7f7f9; color: #111; }
  header { padding: 24px; text-align: center; }
  h1 { margin: 0 0 6px; font-size: 1.6rem; }
  p.sub { margin: 0; color: #555; font-size: 0.95rem; }
  .wrap { max-width: 900px; margin: 0 auto; padding: 12px 16px 32px; }
  .card { background: #fff; border-radius: var(--radius); padding: 18px; box-shadow: 0 4px 16px rgba(0,0,0,0.06); margin-bottom: 14px; }
  .grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
  label { display: block; font-weight: 600; margin-bottom: 6px; }
  input, select, button { width: 100%; padding: 10px 12px; border: 1px solid #d5d7df; border-radius: 10px; background: #fff; font-size: 1rem; }
  input:focus, select:focus { outline: 2px solid #7aa8ff; border-color: #7aa8ff; }
  .btns { display: flex; gap: 10px; flex-wrap: wrap; }
  button.primary { background: #0b6bff; color: white; border: none; }
  button.secondary { background: #eef3ff; color: #0b3bbb; border: 1px solid #bcd0ff; }
  .output { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono"; background: #0b1020; color: #e8f0ff; border-radius: 12px; padding: 12px; white-space: pre-wrap; }
  .hint { color: #666; font-size: 0.9rem; }
  .footer { text-align: center; color: #666; font-size: 0.9rem; padding-top: 12px; }
  .locknote { margin-top:8px; font-size:0.95rem; }
  .locknote b { color:#0b3bbb; }
</style>
</head>
<body>
  <header>
    <h1>Blueprint Scale Calculator</h1>
    <p class="sub">Free: <b>1/4″ = 1′</b>. Unlock all scales for a one-time purchase.</p>
  </header>

  <div class="wrap">

    <!-- SCALE (show all, lock unless entitled) -->
    <div class="card">
      <h3>Scale</h3>
      <div class="grid">
        <div>
          <label>Preset (X″ on plan = Y′ real)</label>
          <select id="scalePreset" class="premium">
            <option value="0.125,1">1/8″ = 1′</option>
            <option value="0.1875,1">3/16″ = 1′</option>
            <option value="0.25,1" selected>1/4″ = 1′ (Free)</option>
            <option value="0.375,1">3/8″ = 1′</option>
            <option value="0.5,1">1/2″ = 1′</option>
            <option value="1,1">1″ = 1′</option>
            <option value="custom">Custom…</option>
          </select>

          <div class="grid" style="margin-top:10px;">
            <div>
              <label>X inches on plan</label>
              <input id="scaleInches" placeholder='e.g., 1/4' value="1/4" />
            </div>
            <div>
              <label>Y feet in real life</label>
              <input id="scaleFeet" placeholder="e.g., 1" value="1" />
            </div>
          </div>

          <div class="locknote" id="proHint">
            Only <b>1/4″ = 1′</b> is available in the free version.
            <button id="unlockBtn" type="button" style="margin-left:6px;">Unlock all scales</button>
          </div>
        </div>

        <div>
          <label>Inch rounding</label>
          <select id="rounding">
            <option value="1">Nearest 1″</option>
            <option value="1/2">Nearest 1/2″</option>
            <option value="1/4">Nearest 1/4″</option>
            <option value="1/8">Nearest 1/8″</option>
            <option value="1/16" selected>Nearest 1/16″</option>
            <option value="1/32">Nearest 1/32″</option>
          </select>
        </div>
      </div>
      <p class="hint">You can enter mixed fractions like <b>1 13/16</b>.</p>
    </div>

    <!-- PLAN → REAL -->
    <div class="card">
      <h3>Plan ➜ Real</h3>
      <div class="grid">
        <div>
          <label>Blueprint measurement (inches)</label>
          <input id="planInches" placeholder='e.g., 9/16, 1 3/8, or 2.5' />
          <div class="hint">Enter inches only.</div>
        </div>
      </div>
      <div class="btns" style="margin-top:10px;">
        <button class="primary" onclick="convertPlanToReal()">Convert to Real Size</button>
        <button class="secondary" onclick="fillExample()">Try 9/16″ at 1/4″ = 1′</button>
      </div>
      <div class="output" id="outPlanToReal" style="margin-top:12px;">Result will appear here…</div>
    </div>

    <!-- REAL → PLAN -->
    <div class="card">
      <h3>Real ➜ Plan</h3>
      <div class="grid">
        <div>
          <label>Real length (feet)</label>
          <input id="realFeet" placeholder="e.g., 2" />
        </div>
        <div>
          <label>Real length (inches)</label>
          <input id="realInches" placeholder='e.g., 3 or 3/4 or 3.5' />
          <div class="hint">Leave feet blank if you just want inches.</div>
        </div>
      </div>
      <div class="btns" style="margin-top:10px;">
        <button class="primary" onclick="convertRealToPlan()">Convert to Plan Size</button>
      </div>
      <div class="output" id="outRealToPlan" style="margin-top:12px;">Result will appear here…</div>
    </div>

    <div class="card">
      <h3>Notes</h3>
      <ul class="hint">
        <li>Accepts whole numbers, decimals (<code>2.5</code>), simple fractions (<code>3/8</code>), and mixed fractions (<code>1 13/16</code>).</li>
        <li>Rounding applies to inches in the formatted output only; decimal values are also shown.</li>
        <li>Common scales: 1/8″ = 1′, 1/4″ = 1′, 1/2″ = 1′, 1″ = 1′.</li>
      </ul>
      <div class="footer">© Your Name</div>
    </div>
  </div>

<script>
  // ---------- PAYMENT LINK (set this to your Stripe Payment Link) ----------
  const PAYMENT_LINK_URL = "https://buy.stripe.com/your_payment_link"; // TODO: replace

  // ---------- ENTITLEMENT ----------
  function isEntitled() {
    try { return !!localStorage.getItem("entitlement"); } catch { return false; }
  }

  function setEntitled(token) {
    try { localStorage.setItem("entitlement", token); } catch {}
  }

  // ---------- PARSING & MATH ----------
  function parseNumberish(str) {
    if (!str) return NaN;
    str = (''+str).trim();
    if (!str) return NaN;

    // Mixed fraction "1 13/16"
    const mixed = str.match(/^(-?\\d+)\\s+(\\d+)\\/(\\d+)$/);
    if (mixed) {
      const whole = parseFloat(mixed[1]);
      const num = parseFloat(mixed[2]);
      const den = parseFloat(mixed[3]);
      if (!den) return NaN;
      return whole + (whole < 0 ? -num/den : num/den);
    }
    // Simple fraction "13/16"
    const frac = str.match(/^(-?\\d+)\\/(\\d+)$/);
    if (frac) {
      const num = parseFloat(frac[1]);
      const den = parseFloat(frac[2]);
      if (!den) return NaN;
      return num/den;
    }
    // Decimal/whole
    const val = parseFloat(str);
    return isNaN(val) ? NaN : val;
  }

  function roundToFractionInches(inches, fracStr) {
    if (!fracStr || fracStr === "1") return Math.round(inches);
    const parts = fracStr.split('/');
    if (parts.length !== 2) return inches;
    const denom = parseFloat(parts[1]);
    if (!denom || isNaN(denom)) return inches;
    const step = 1/denom;
    return Math.round(inches/step)*step;
  }

  function formatFeetInches(feetDecimal, rounding) {
    if (!isFinite(feetDecimal)) return "—";
    let feet = Math.trunc(feetDecimal);
    let inches = (feetDecimal - feet) * 12;
    inches = roundToFractionInches(inches, rounding);
    if (Math.abs(inches - 12) < 1e-9) { feet += 1; inches = 0; }

    function toFraction(inchVal, rounding) {
      if (rounding === "1") return {whole: Math.round(inchVal), num: 0, den: 1};
      const parts = rounding.split('/');
      const den = parseInt(parts[1] || "16", 10);
      const whole = Math.trunc(inchVal);
      const frac = inchVal - whole;
      const num = Math.round(frac * den);
      function gcd(a,b){ return b ? gcd(b, a%b) : a; }
      const g = gcd(num, den) || 1;
      return {whole, num: num/g, den: den/g};
    }
    const f = toFraction(inches, rounding);
    let inchStr = "";
    if (Math.abs(f.num) < 1e-9) {
      inchStr = `${Math.round(inches)}″`;
    } else if (f.whole > 0) {
      inchStr = `${f.whole} ${f.num}/${f.den}″`;
    } else {
      inchStr = `${f.num}/${f.den}″`;
    }
    return `${feet}′-${inchStr}`;
  }

  function getScaleFactorFeetPerInch() {
    const XplanInches = parseNumberish(document.getElementById('scaleInches').value);
    const YrealFeet = parseNumberish(document.getElementById('scaleFeet').value);
    if (!isFinite(XplanInches) || XplanInches <= 0 || !isFinite(YrealFeet) || YrealFeet <= 0) return NaN;
    return YrealFeet / XplanInches; // feet per 1 inch on plan
  }

  // ---------- CONVERSIONS ----------
  function convertPlanToReal() {
    const planInches = parseNumberish(document.getElementById('planInches').value);
    const fpi = getScaleFactorFeetPerInch();
    const rounding = document.getElementById('rounding').value;
    const out = document.getElementById('outPlanToReal');

    if (!isFinite(planInches) || planInches < 0) {
      out.textContent = "Please enter a valid plan inches value (e.g., 9/16, 1 13/16, 2.5).";
      return;
    }
    if (!isFinite(fpi)) {
      out.textContent = "Please enter a valid scale (X inches on plan = Y feet in real life).";
      return;
    }
    const realFeetDecimal = planInches * fpi;
    const pretty = formatFeetInches(realFeetDecimal, rounding);
    const inchesTotal = realFeetDecimal * 12;

    out.textContent =
`REAL SIZE
• Feet & inches: ${pretty}
• Decimal feet: ${realFeetDecimal.toFixed(4)} ft
• Decimal inches: ${inchesTotal.toFixed(2)} in`;
  }

  function convertRealToPlan() {
    const feet = parseNumberish(document.getElementById('realFeet').value);
    const inches = parseNumberish(document.getElementById('realInches').value);
    const fpi = getScaleFactorFeetPerInch();
    const out = document.getElementById('outRealToPlan');

    const feetVal = isFinite(feet) ? feet : 0;
    const inchesVal = isFinite(inches) ? inches : 0;

    if ((!isFinite(feetVal) || feetVal < 0) && (!isFinite(inchesVal) || inchesVal < 0)) {
      out.textContent = "Please enter a real-world length in feet and/or inches.";
      return;
    }
    if (!isFinite(fpi)) {
      out.textContent = "Please enter a valid scale (X inches on plan = Y feet in real life).";
      return;
    }

    const totalFeet = (feetVal >= 0 ? feetVal : 0) + (inchesVal >= 0 ? inchesVal : 0)/12;
    const planInches = totalFeet / fpi;

    out.textContent =
`PLAN SIZE
• Inches on plan: ${planInches.toFixed(3)} in
• Inches as fraction (approx): ${toNearestFraction(planInches, 16)} in
• Decimal feet on plan: ${(planInches/12).toFixed(4)} ft`;
  }

  function toNearestFraction(inches, denom) {
    const whole = Math.trunc(inches);
    const frac = inches - whole;
    const num = Math.round(frac * denom);
    function gcd(a,b){ return b ? gcd(b, a%b) : a; }
    const g = gcd(num, denom) || 1;
    const numR = num/g, denR = denom/g;
    if (numR === 0) return `${whole}`;
    if (whole === 0) return `${numR}/${denR}`;
    return `${whole} ${numR}/${denR}`;
  }

  // ---------- UI HELPERS ----------
  function setScaleInputsFromPreset() {
    const preset = document.getElementById('scalePreset').value;
    const inches = document.getElementById('scaleInches');
    const feet = document.getElementById('scaleFeet');
    if (preset === "custom") return;
    const [x, y] = preset.split(',').map(Number);
    if (!isNaN(x) && !isNaN(y)) {
      inches.value = x === 0.25 ? "1/4" :
                     x === 0.125 ? "1/8" :
                     x === 0.1875 ? "3/16" :
                     x === 0.375 ? "3/8" :
                     x === 0.5 ? "1/2" :
                     x === 1 ? "1" : x.toString();
      feet.value = y.toString();
    }
  }

  function applyPaywall() {
    const entitled = isEntitled();
    const preset = document.getElementById('scalePreset');
    const inches = document.getElementById('scaleInches');
    const feet = document.getElementById('scaleFeet');
    const proHint = document.getElementById('proHint');
    const unlockBtn = document.getElementById('unlockBtn');

    if (!entitled) {
      preset.value = "0.25,1";
      setScaleInputsFromPreset();
      inches.disabled = true;
      feet.disabled = true;
      proHint.style.display = "block";
      unlockBtn.onclick = () => {
        if (PAYMENT_LINK_URL.startsWith("http")) {
          window.location.href = PAYMENT_LINK_URL;
        } else {
          alert("Payment is not configured yet.");
        }
      };
    } else {
      inches.disabled = false;
      feet.disabled = false;
      proHint.style.display = "none";
    }

    preset.onchange = () => {
      if (!isEntitled()) {
        if (preset.value !== "0.25,1" && preset.value !== "custom") {
          alert("This scale is part of Pro. Unlock all scales to use it.");
          preset.value = "0.25,1";
        }
        setScaleInputsFromPreset();
      } else {
        if (preset.value === "custom") {
          inches.disabled = false;
          feet.disabled = false;
        } else {
          inches.disabled = false;
          feet.disabled = false;
          setScaleInputsFromPreset();
        }
      }
    };
  }

  function fillExample() {
    document.getElementById('scalePreset').value = "0.25,1";
    setScaleInputsFromPreset();
    document.getElementById('planInches').value = "9/16";
    document.getElementById('rounding').value = "1/16";
    convertPlanToReal();
  }

  document.addEventListener('DOMContentLoaded', () => {
    applyPaywall();
  });
</script>
</body>
</html>
